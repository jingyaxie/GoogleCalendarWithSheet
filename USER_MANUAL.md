# 📅 课程同步系统 - 用户使用手册

## 📖 目录

1. [系统简介](#系统简介)
2. [功能特性](#功能特性)
3. [快速开始](#快速开始)
4. [配置说明](#配置说明)
5. [使用方法](#使用方法)
6. [数据格式](#数据格式)
7. [状态表说明](#状态表说明)
8. [时区设置](#时区设置)
9. [常见问题](#常见问题)
10. [注意事项](#注意事项)

---

## 🎯 系统简介

课程同步系统是一个基于 Google Apps Script 的自动化工具，用于将 Google 表格中的课程信息自动同步到 Google 日历，并发送邮件通知给老师和学生。

### 主要功能

- 📊 **多Sheet管理**：支持同时管理多个课程表
- 📧 **邮件通知**：自动发送课程通知邮件
- 📅 **日历同步**：自动创建、更新和删除日历事件
- 🔍 **智能检测**：自动检测课程变化，只处理有变化的记录
- 📝 **状态跟踪**：记录每条课程的处理状态和事件ID
- 🗑️ **删除处理**：自动删除已删除课程的日历事件并发送取消邮件

---

## ✨ 功能特性

### 核心功能

- ✅ **多Sheet支持**：可以同时管理多个课程表，每个表独立配置
- ✅ **自动同步**：一键同步所有配置的课程表
- ✅ **智能更新**：检测课程变化，只更新有变化的记录
- ✅ **邮件通知**：自动发送课程通知邮件给老师和学生
- ✅ **日历集成**：自动创建、更新和删除日历事件
- ✅ **状态跟踪**：记录每条课程的处理状态、事件ID和时间戳
- ✅ **删除处理**：自动删除已删除课程的日历事件并发送取消邮件
- ✅ **事件验证**：自动验证日历事件是否存在，处理手动删除的情况
- ✅ **时区支持**：支持为每个Sheet设置不同的时区
- ✅ **邮件提醒**：支持配置提前多长时间通过邮件提醒上课

### 用户体验

- 🎨 **自定义菜单**：提供友好的菜单界面，无需手动运行脚本
- 📋 **配置管理**：统一的配置表管理所有课程表
- 📊 **状态查看**：可以方便地查看每个课程表的处理状态
- 🔄 **自动处理**：自动处理记录ID、状态同步等复杂逻辑

---

## 🚀 快速开始

### 第一步：准备配置表

1. 在 Google 表格中创建一个名为 `_SheetConfig` 的 Sheet（配置表）
2. 在配置表中设置表头和数据，格式如下：

| Sheet名称 | 启用状态 | 组织者日历ID | 老师邮箱 | 学生邮箱 | 时区 | 提醒时间 |
|-----------|----------|------------|----------|----------|------|----------|
| 张三同学课程表 | 是 | jovixiao2022@gmail.com | jovixiao2022@gmail.com | jingyaxiegm1@gmail.com | Asia/Shanghai | 30 |

**重要说明：**
- ✅ **列的顺序可以随意调整**，只要表头名称正确即可
- ✅ **表头名称支持中英文**，不区分大小写
- ✅ **系统会自动匹配表头**，支持多种变体

**配置说明：**

**必需列：**
- **Sheet名称**：要处理的课程表名称（必须与实际的 Sheet 名称完全一致）
  - 支持的表头名称：`Sheet名称`、`Sheet Name`、`名称`、`Name`、`Sheet`、`表名`等
  
- **启用状态**：是否启用该课程表
  - 支持的表头名称：`启用状态`、`启用`、`Enabled`、`Status`、`是否启用`等
  - 支持的值：`是`、`启用`、`Yes`、`Enabled`、`True`、`1`、`true`（表示启用）
  - 其他值表示不启用（该行会被跳过）
  
- **组织者日历ID**：组织者的 Google 日历 ID（通常是邮箱地址），事件将在此日历上创建，老师和学生将作为受邀者
  - 支持的表头名称：`组织者日历ID`、`组织者日历`、`Organizer Calendar ID`、`管理员日历ID`、`Admin Calendar ID`等
  - **必须填写**，否则该行会被跳过

**可选列：**
- **老师邮箱**：老师的邮箱地址（用于邀请和发送邮件）
  - 支持的表头名称：`老师邮箱`、`Teacher Email`、`老师邮件`等
  - 如果不填写，老师将不会收到邀请邮件
  
- **学生邮箱**：学生的邮箱地址（用于邀请和发送邮件）
  - 支持的表头名称：`学生邮箱`、`Student Email`、`学生邮件`等
  - 如果不填写，学生将不会收到邀请邮件
  
- **时区**：可选，如果不填写，会使用默认时区 `Asia/Shanghai`
  - 支持的表头名称：`时区`、`Timezone`、`Time Zone`、`TZ`等
  - 支持的时区格式请参考"时区设置"章节
  
- **提醒时间**：可选，提前多少分钟通过邮件提醒上课（单位：分钟）
  - 支持的表头名称：`提醒时间`、`Reminder Minutes`、`Reminder`、`提醒`、`邮件提醒`、`Email Reminder`、`提前提醒`、`Minutes Before`等
  - 填写提前提醒的分钟数，如：`30` 表示提前30分钟提醒，`60` 表示提前60分钟提醒
  - 如果不配置或留空，创建事件时不会添加提醒
  - **注意**：提醒会发送给所有参与者（组织者、老师、学生）

### 第二步：准备课程表

1. 创建一个课程表 Sheet（名称与配置表中的"Sheet名称"一致）
2. 设置表头和数据，格式如下：

| 课次 | 日期 | 课程内容/主题 | 开始时间 | 结束时间 | 老师 | 学生 |
|------|------|--------------|----------|----------|------|------|
| 第1次 | 2025/11/14 | 基础线条与构图 | 09:00 | 11:30 | 李老师 | 张三 |

**重要说明：**
- ✅ **列的顺序可以随意调整**，只要表头名称正确即可
- ✅ **表头名称支持中英文**，不区分大小写
- ✅ **系统会自动匹配表头**，支持多种变体
- ✅ **系统会自动添加"记录ID"列**（用于跟踪记录，无需手动添加）

**必需列：**
- **课次**：课程次数（如：第1次、第2次）
  - 支持的表头名称：`课次`、`Lesson`、`课程次数`、`Lesson Number`等
  - **必须填写**，用于标识不同的课程
  
- **日期**：课程日期
  - 支持的表头名称：`日期`、`Date`、`课程日期`等
  - 支持的格式：`2025/11/14`、`2025-11-14`、`2025年11月14日`（推荐使用 `2025/11/14` 或 `2025-11-14`）
  - **必须填写**，否则该行会被跳过
  
- **课程内容/主题**：课程主题或内容
  - 支持的表头名称：`课程内容/主题`、`课程内容`、`主题`、`Course Title`、`课程主题`等
  - 将作为日历事件的标题
  
- **开始时间**：课程开始时间
  - 支持的表头名称：`开始时间`、`Start Time`、`开始`、`上课时间`等
  - 支持的格式：`09:00`、`9:00`、`09:00:00`（推荐使用 `09:00`）
  - **必须填写**，否则该行会被跳过
  
- **结束时间**：课程结束时间
  - 支持的表头名称：`结束时间`、`End Time`、`结束`、`下课时间`等
  - 支持的格式：`11:30`、`11:30:00`（推荐使用 `11:30`）
  - **必须填写**，否则该行会被跳过
  
- **老师**：老师姓名
  - 支持的表头名称：`老师`、`Teacher`、`教师`、`老师姓名`等
  - 将显示在日历事件的描述中
  
- **学生**：学生姓名
  - 支持的表头名称：`学生`、`Student`、`学员`、`学生姓名`等
  - 将显示在日历事件的描述中

**自动添加的列：**
- **记录ID**：系统自动生成并添加到最后一列，用于跟踪记录，无需手动添加或修改

### 第三步：执行同步

1. 打开 Google 表格
2. 点击菜单栏中的 **📅 课程同步** → **🔄 执行同步**
3. 确认执行后，系统会自动处理所有课程

**首次运行：**
- 系统会自动创建状态表（隐藏表，名称格式：`_StatusLog_{Sheet名称}`）
- 系统会自动生成记录ID并添加到课程表的最后一列（列名：`记录ID`）
- 系统会在组织者日历上创建事件，并自动发送邀请邮件给老师和学生（如果配置了邮箱）
- 系统会自动添加提醒（如果配置了提醒时间）

---

## ⚙️ 配置说明

### 配置表（_SheetConfig）

配置表用于管理要处理的课程表列表，必须包含以下列：

#### 必需列（必须填写）

1. **Sheet名称**
   - **说明**：要处理的课程表名称（必须与实际的 Sheet 名称完全一致）
   - **支持的表头名称**：`Sheet名称`、`Sheet Name`、`名称`、`Name`、`Sheet`、`表名`等
   - **示例**：`张三同学课程表`
   - **注意**：必须与实际的 Sheet 名称完全一致，区分大小写

2. **启用状态**
   - **说明**：是否启用该课程表
   - **支持的表头名称**：`启用状态`、`启用`、`Enabled`、`Status`、`是否启用`等
   - **支持的值**：`是`、`启用`、`Yes`、`Enabled`、`True`、`1`、`true`（表示启用）
   - **其他值**：表示不启用（该行会被跳过）
   - **示例**：`是`、`Yes`、`1`

3. **组织者日历ID**
   - **说明**：组织者的 Google 日历 ID（通常是邮箱地址），事件将在此日历上创建，老师和学生将作为受邀者
   - **支持的表头名称**：`组织者日历ID`、`组织者日历`、`Organizer Calendar ID`、`管理员日历ID`、`Admin Calendar ID`等
   - **示例**：`jovixiao2022@gmail.com`
   - **注意**：必须填写，否则该行会被跳过

#### 可选列（可以不填写）

4. **老师邮箱**
   - **说明**：老师的邮箱地址（用于邀请和发送邮件）
   - **支持的表头名称**：`老师邮箱`、`Teacher Email`、`老师邮件`、`TeacherEmail`等
   - **示例**：`teacher@example.com`
   - **注意**：如果不填写，老师将不会收到邀请邮件

5. **学生邮箱**
   - **说明**：学生的邮箱地址（用于邀请和发送邮件）
   - **支持的表头名称**：`学生邮箱`、`Student Email`、`学生邮件`、`StudentEmail`等
   - **示例**：`student@example.com`
   - **注意**：如果不填写，学生将不会收到邀请邮件

6. **时区**
   - **说明**：用于设置该Sheet的时区
   - **支持的表头名称**：`时区`、`Timezone`、`Time Zone`、`TZ`等
   - **示例**：`Asia/Shanghai`、`America/New_York`、`Europe/Paris`
   - **默认值**：如果不填写，会使用默认时区 `Asia/Shanghai`
   - **支持的时区格式**：请参考"时区设置"章节

7. **提醒时间**
   - **说明**：提前多少分钟通过邮件提醒上课（单位：分钟）
   - **支持的表头名称**：`提醒时间`、`Reminder Minutes`、`Reminder`、`提醒`、`邮件提醒`、`Email Reminder`、`提前提醒`、`Minutes Before`等
   - **示例**：`30`（提前30分钟）、`60`（提前60分钟）、`120`（提前2小时）
   - **默认值**：如果不配置或留空，创建事件时不会添加提醒
   - **注意**：提醒会发送给所有参与者（组织者、老师、学生），包括邮件提醒和弹出提醒

**重要提示：**
- ✅ **列的顺序可以随意调整**，只要表头名称正确即可
- ✅ **表头名称支持中英文**，不区分大小写
- ✅ **系统会自动匹配表头**，支持多种变体
- ⚠️ **必需列必须填写**，否则该行会被跳过

### 课程表格式

每个课程表必须包含以下列：

#### 必需列（必须填写）

1. **课次**
   - **说明**：课程次数（如：第1次、第2次）
   - **支持的表头名称**：`课次`、`Lesson`、`课程次数`、`Lesson Number`等
   - **示例**：`第1次`、`第2次`、`Lesson 1`
   - **注意**：用于标识不同的课程，建议填写

2. **日期**
   - **说明**：课程日期
   - **支持的表头名称**：`日期`、`Date`、`课程日期`等
   - **支持的格式**：`2025/11/14`、`2025-11-14`、`2025年11月14日`（推荐使用 `2025/11/14` 或 `2025-11-14`）
   - **示例**：`2025/11/14`、`2025-11-14`
   - **注意**：必须填写，否则该行会被跳过

3. **课程内容/主题**
   - **说明**：课程主题或内容，将作为日历事件的标题
   - **支持的表头名称**：`课程内容/主题`、`课程内容`、`主题`、`Course Title`、`课程主题`等
   - **示例**：`基础线条与构图`、`数学基础`、`英语口语`

4. **开始时间**
   - **说明**：课程开始时间
   - **支持的表头名称**：`开始时间`、`Start Time`、`开始`、`上课时间`等
   - **支持的格式**：`09:00`、`9:00`、`09:00:00`（推荐使用 `09:00`）
   - **示例**：`09:00`、`14:30`
   - **注意**：必须填写，否则该行会被跳过

5. **结束时间**
   - **说明**：课程结束时间
   - **支持的表头名称**：`结束时间`、`End Time`、`结束`、`下课时间`等
   - **支持的格式**：`11:30`、`11:30:00`（推荐使用 `11:30`）
   - **示例**：`11:30`、`16:00`
   - **注意**：必须填写，否则该行会被跳过

6. **老师**
   - **说明**：老师姓名，将显示在日历事件的描述中
   - **支持的表头名称**：`老师`、`Teacher`、`教师`、`老师姓名`等
   - **示例**：`李老师`、`张老师`

7. **学生**
   - **说明**：学生姓名，将显示在日历事件的描述中
   - **支持的表头名称**：`学生`、`Student`、`学员`、`学生姓名`等
   - **示例**：`张三`、`李四`

#### 自动添加的列（系统自动管理）

8. **记录ID**
   - **说明**：系统自动生成并添加到最后一列，用于跟踪记录
   - **格式**：`REC_时间戳_随机数`（如：`REC_1762502540720_2532`）
   - **注意**：无需手动添加或修改，系统会自动管理

**重要提示：**
- ✅ **列的顺序可以随意调整**，只要表头名称正确即可
- ✅ **表头名称支持中英文**，不区分大小写
- ✅ **系统会自动匹配表头**，支持多种变体
- ⚠️ **必需列必须填写**，否则该行会被跳过
- ⚠️ **日期和时间格式要正确**，否则可能无法解析

---

## 📋 使用方法

### 方法一：使用菜单（推荐）

1. 打开 Google 表格
2. 在菜单栏中找到 **📅 课程同步** 菜单
3. 点击 **🔄 执行同步**
4. 在弹出的确认对话框中点击 **是**
5. 等待执行完成，系统会显示完成提示

### 方法二：手动运行脚本

1. 打开 Google Apps Script 编辑器
2. 选择 `main` 函数
3. 点击运行按钮

### 菜单功能说明

#### 🔄 执行同步

- 处理所有启用的课程表
- 发送邮件通知
- 创建或更新日历事件
- 更新状态记录
- 处理已删除的记录

#### 📋 查看配置

- 打开并激活配置表
- 方便查看和编辑配置

#### 📊 查看状态表

- 查看课程处理状态
- 如果有多个课程表，可以选择要查看的表
- 自动显示隐藏的状态表

#### ℹ️ 关于

- 查看系统信息和版本
- 了解系统功能

---

## 📊 数据格式

### 日期格式

支持的日期格式：
- `2025/11/14`
- `2025-11-14`
- `2025年11月14日`（部分支持）

### 时间格式

支持的时间格式：
- `09:00`
- `9:00`
- `09:00:00`

### 启用状态格式

支持的启用状态值（表示启用）：
- 中文：`是`、`启用`
- 英文：`Yes`、`Enabled`、`True`
- 数字：`1`
- 布尔值：`true`

其他值表示不启用。

---

## 📊 状态表说明

### 状态表概述

状态表是系统自动创建的隐藏表，用于记录每条课程的处理状态。状态表名称格式：`_StatusLog_{Sheet名称}`

例如，如果课程表名称是"张三同学课程表"，则状态表名称是"`_StatusLog_张三同学课程表`"。

### 状态表结构

状态表包含以下列：

| 列名 | 说明 | 示例 |
|------|------|------|
| 记录ID | 唯一标识符，与课程表的记录ID对应 | `REC_1762590558439_5970` |
| 课次 | 课程次数 | `第1次` |
| 日期 | 课程日期 | `2025-11-14` |
| Token | 关键信息哈希值，用于检测变化 | `f9e641c53c33b0cf5ac802997833dd57` |
| 老师邮件状态 | 老师邮件发送状态 | `已发送`、`未发送` |
| 老师邮件发送时间 | 老师邮件发送时间 | `2025-11-08 16:37:17` |
| 老师日历ID | 老师日历ID | `jovixiao2022@gmail.com` |
| 老师日历事件ID | 老师日历事件ID | `abc123def456@google.com` |
| 老师日历创建时间 | 老师日历事件创建时间 | `2025-11-08 16:37:17` |
| 学生邮件状态 | 学生邮件发送状态 | `已发送`、`未发送` |
| 学生邮件发送时间 | 学生邮件发送时间 | `2025-11-08 16:37:17` |
| 学生日历ID | 学生日历ID | `jingyaxiegm1@gmail.com` |
| 学生日历事件ID | 学生日历事件ID | `xyz789uvw012@google.com` |
| 学生日历创建时间 | 学生日历事件创建时间 | `2025-11-08 16:37:17` |
| 处理状态 | 整体处理状态 | `已完成`、`部分失败`、`失败` |
| 最后更新时间 | 最后更新时间 | `2025-11-08 17:18:30` |

### 处理状态说明

- **已完成**：老师和学生的日历事件都创建成功
- **部分失败**：只有老师或学生的日历事件创建成功
- **失败**：老师和学生的日历事件都创建失败

### 查看状态表

1. 点击菜单栏中的 **📅 课程同步** → **📊 查看状态表**
2. 如果有多个课程表，选择要查看的表
3. 系统会自动显示隐藏的状态表

**注意：**
- 状态表是隐藏的，不建议手动修改
- 状态表会自动与课程表同步
- 删除课程表中的记录后，状态表中的对应记录也会被清除

---

## 🌍 时区设置

### 时区配置方法

在配置表 `_SheetConfig` 中添加"时区"列，支持的时区格式如下：

**支持的时区表头名称：**
- `时区`
- `Timezone`
- `Time Zone`
- `TZ`

### 主流时区格式

| 国家/地区 | 时区标识符 | 说明 |
|-----------|-----------|------|
| 中国 | `Asia/Shanghai` | 中国标准时间（UTC+8） |
| 中国香港 | `Asia/Hong_Kong` | 香港时间（UTC+8） |
| 中国台湾 | `Asia/Taipei` | 台湾时间（UTC+8） |
| 日本 | `Asia/Tokyo` | 日本标准时间（UTC+9） |
| 韩国 | `Asia/Seoul` | 韩国标准时间（UTC+9） |
| 新加坡 | `Asia/Singapore` | 新加坡时间（UTC+8） |
| 印度 | `Asia/Kolkata` | 印度标准时间（UTC+5:30） |
| 法国 | `Europe/Paris` | 法国时间（UTC+1，夏令时UTC+2） |
| 英国 | `Europe/London` | 英国时间（UTC+0，夏令时UTC+1） |
| 德国 | `Europe/Berlin` | 德国时间（UTC+1，夏令时UTC+2） |
| 意大利 | `Europe/Rome` | 意大利时间（UTC+1，夏令时UTC+2） |
| 西班牙 | `Europe/Madrid` | 西班牙时间（UTC+1，夏令时UTC+2） |
| 美国东部 | `America/New_York` | 美国东部时间（UTC-5，夏令时UTC-4） |
| 美国中部 | `America/Chicago` | 美国中部时间（UTC-6，夏令时UTC-5） |
| 美国山地 | `America/Denver` | 美国山地时间（UTC-7，夏令时UTC-6） |
| 美国西部 | `America/Los_Angeles` | 美国西部时间（UTC-8，夏令时UTC-7） |
| 加拿大东部 | `America/Toronto` | 加拿大东部时间（UTC-5，夏令时UTC-4） |
| 加拿大西部 | `America/Vancouver` | 加拿大西部时间（UTC-8，夏令时UTC-7） |
| 澳大利亚东部 | `Australia/Sydney` | 澳大利亚东部时间（UTC+10，夏令时UTC+11） |
| 澳大利亚西部 | `Australia/Perth` | 澳大利亚西部时间（UTC+8） |
| 新西兰 | `Pacific/Auckland` | 新西兰时间（UTC+12，夏令时UTC+13） |
| 巴西 | `America/Sao_Paulo` | 巴西时间（UTC-3） |
| 墨西哥 | `America/Mexico_City` | 墨西哥时间（UTC-6，夏令时UTC-5） |
| 俄罗斯莫斯科 | `Europe/Moscow` | 莫斯科时间（UTC+3） |
| 俄罗斯远东 | `Asia/Vladivostok` | 俄罗斯远东时间（UTC+10） |
| 阿联酋 | `Asia/Dubai` | 阿联酋时间（UTC+4） |
| 沙特阿拉伯 | `Asia/Riyadh` | 沙特阿拉伯时间（UTC+3） |
| 土耳其 | `Europe/Istanbul` | 土耳其时间（UTC+3） |
| 南非 | `Africa/Johannesburg` | 南非时间（UTC+2） |
| 埃及 | `Africa/Cairo` | 埃及时间（UTC+2） |

### 配置示例

| Sheet名称 | 启用状态 | 组织者日历ID | 老师邮箱 | 学生邮箱 | 时区 | 提醒时间 |
|-----------|----------|------------|----------|----------|------|----------|
| 中国课程表 | 是 | organizer@example.com | teacher@example.com | student@example.com | Asia/Shanghai | 30 |
| 美国课程表 | 是 | organizer@example.com | teacher@example.com | student@example.com | America/New_York | 60 |
| 法国课程表 | 是 | organizer@example.com | teacher@example.com | student@example.com | Europe/Paris | 120 |

### 注意事项

- 时区列是可选的，如果不配置，会使用默认时区 `Asia/Shanghai`
- 每个 Sheet 可以有不同的时区
- 时区会影响日期时间的解析和格式化
- 使用 IANA 时区标识符（如 `Asia/Shanghai`），不要使用缩写（如 `CST`、`EST`）
- 系统会自动处理夏令时（DST）转换
- 时区信息会记录在日志中，方便调试

### 如何查找更多时区

- 访问 [IANA 时区数据库](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)
- 或使用 `America/`、`Europe/`、`Asia/` 等前缀搜索

---

## ❓ 常见问题

### Q1: 菜单没有出现怎么办？

**A:** 
1. 刷新页面或重新打开表格
2. 检查是否已保存脚本
3. 尝试手动运行 `onOpen()` 函数

### Q2: 执行同步时提示"配置表不存在"？

**A:** 
1. 确保已创建名为 `_SheetConfig` 的 Sheet
2. 检查 Sheet 名称是否完全一致（包括下划线）
3. 确保 Sheet 名称没有多余的空格

### Q3: 提示"缺少Sheet名称列"？

**A:** 
1. 检查配置表的第一行是否有表头
2. 确保表头中包含"Sheet名称"列（支持多种变体）
3. 检查表头名称是否正确（不区分大小写）

### Q4: 邮件没有发送？

**A:** 
1. 检查配置表中的邮箱地址是否正确
2. 确保邮箱地址格式正确
3. 检查 Google Apps Script 的权限设置
4. 查看执行日志了解详细错误信息

### Q5: 日历事件没有创建？

**A:** 
1. 检查配置表中的日历ID是否正确
2. 确保日历已共享给脚本运行账号
3. 检查日历ID格式（通常是邮箱地址）
4. 查看执行日志了解详细错误信息

### Q6: 如何更新已创建的课程？

**A:** 
1. 直接修改课程表中的课程信息
2. 执行同步，系统会自动检测变化
3. 如果关键信息（日期、时间、主题等）有变化，系统会：
   - 更新日历事件
   - 重新发送邮件通知

### Q7: 如何删除课程？

**A:** 
1. 在课程表中删除对应的行
2. 执行同步，系统会自动：
   - 删除对应的日历事件
   - 发送取消邮件
   - 清除状态记录

### Q8: 状态表是什么？

**A:** 
- 状态表是系统自动创建的隐藏表，用于记录每条课程的处理状态
- 状态表名称格式：`_StatusLog_{Sheet名称}`
- 可以通过菜单中的"查看状态表"功能查看
- 状态表包含：记录ID、处理状态、事件ID、邮件发送时间等信息

### Q9: 记录ID是什么？

**A:** 
- 记录ID是系统自动生成的唯一标识符
- 用于确保课程表和状态表的一一对应关系
- 即使课程信息发生变化，记录ID保持不变
- 首次同步后，记录ID会自动添加到课程表的最后一列

### Q10: 可以同时处理多个课程表吗？

**A:** 
- 可以！在配置表中添加多行，每行对应一个课程表
- 系统会按顺序处理所有启用的课程表
- 每个课程表使用独立的状态表

### Q11: 为什么状态表显示"部分失败"？

**A:** 
- 这表示只有老师或学生的日历事件创建成功
- 可能的原因：
  - 其中一个日历ID不正确
  - 其中一个日历没有正确共享
  - 其中一个日历事件创建失败
- 查看执行日志了解详细错误信息

### Q12: 日历事件被手动删除了怎么办？

**A:** 
- 系统会自动检测日历事件是否存在
- 如果发现事件被手动删除，系统会：
  - 清除状态表中的事件ID
  - 重新创建日历事件
- 下次执行同步时会自动处理

### Q13: 如何设置课程提醒？

**A:** 
- 在配置表 `_SheetConfig` 中添加"提醒时间"列
- 填写提前提醒的分钟数，如：`30` 表示提前30分钟提醒，`60` 表示提前60分钟提醒
- 系统会在课程开始前指定的时间通过邮件提醒参与者
- 如果不配置或留空，创建事件时不会添加提醒
- 支持的表头名称：`提醒时间`、`Reminder Minutes`、`Reminder`、`提醒`、`邮件提醒`等

### Q14: 提醒时间可以设置哪些值？

**A:** 
- 提醒时间以分钟为单位，填写数字即可
- 常见设置：
  - `15`：提前15分钟提醒
  - `30`：提前30分钟提醒
  - `60`：提前1小时提醒
  - `120`：提前2小时提醒
  - `1440`：提前1天提醒
- 建议根据课程时长和重要性设置合适的提醒时间

---

## ⚠️ 注意事项

### 权限要求

首次运行时，系统会提示授权，请点击"允许"。需要以下权限：

- **Google Sheets 权限**：读取和写入表格数据
- **Gmail 权限**：发送邮件
- **Google Calendar 权限**：创建、更新、删除日历事件

### 日历共享

- 确保要创建事件的日历已共享给脚本运行账号
- 共享权限至少需要"可以查看所有活动详情"
- 如果使用邮箱作为日历ID，确保该邮箱的日历已正确共享

### 数据备份

- 建议定期备份配置表和课程表数据
- 状态表会自动管理，无需手动备份
- 删除课程表前，建议先备份数据

### 性能考虑

- 如果课程表数据量很大，执行时间可能较长
- 建议每次处理不超过1000条记录
- 系统会自动跳过已处理且无变化的记录

### 邮件模板

- 系统使用默认的邮件模板
- 邮件内容包含课程主题、日期、时间、老师和学生信息
- 如需自定义邮件模板，请修改代码中的 `EMAIL_TEMPLATE` 配置

### 错误处理

- 如果某条记录处理失败，系统会继续处理其他记录
- 失败记录的状态会标记为"失败"或"部分失败"
- 可以通过查看状态表了解详细的处理结果
- 查看执行日志可以了解详细的错误信息

### 最佳实践

1. **首次使用前**：
   - 先创建一个测试课程表
   - 使用测试数据验证功能
   - 确认邮件和日历事件正常创建

2. **日常使用**：
   - 定期执行同步，保持数据最新
   - 及时处理失败的记录
   - 定期检查状态表

3. **数据维护**：
   - 保持配置表数据准确
   - 及时更新课程信息
   - 删除不需要的课程记录

---

## 📞 技术支持

如果遇到问题，请：

1. 查看本文档的"常见问题"部分
2. 检查执行日志中的错误信息
3. 确认配置表和课程表格式是否正确
4. 检查权限设置是否正确

---

## 📝 更新日志

### 版本 2.0

- ✅ 支持多Sheet配置
- ✅ 从配置表读取邮箱和日历ID
- ✅ 简化主表格式
- ✅ 添加自定义菜单
- ✅ 改进表头匹配逻辑
- ✅ 支持动态时区配置
- ✅ 添加事件验证功能
- ✅ 改进状态记录逻辑
- ✅ 修复日期对象误写入事件ID的问题
- ✅ 改进事件ID验证和格式化
- ✅ 添加速率限制处理和重试机制
- ✅ 支持配置提醒时间，自动添加邮件提醒

### 版本 1.0

- ✅ 基础功能实现
- ✅ 单Sheet支持
- ✅ 邮件和日历同步
- ✅ 状态跟踪

---

**最后更新：** 2025年

**文档版本：** 2.0
